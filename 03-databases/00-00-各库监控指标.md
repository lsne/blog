
## MySQL/MariaDB

### 一. 报警指标以及阈值

#### 1.  MySQL down

>  [2.1.1. MySQL down](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-1) 

#### 2. 连接数太多

>  [2.1.2. MySQL too many connections (> 80%)](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-2) 

#### 3. 从库IO线程

>  [2.1.5. MySQL Slave IO thread not running](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-5) 

#### 4. 从库SQL线程

> [2.1.6. MySQL Slave SQL thread not running](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-6) 

#### 5. 从库同步延迟

> [2.1.7. MySQL Slave replication lag](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-7) 

### 二. 性能指标(曲线图)

#### 1. QPS

```
rate(mysql_global_status_commands_total{command=\"delete\",uuid=\"10.249.22.179_11086\"}[1m])
rate(mysql_global_status_commands_total{command=\"select\",uuid=\"10.249.22.179_11086\"}[1m])
mysql_global_status_commands_total{command=\"insert\",uuid=\"10.249.22.179_11086\"}[1m])
rate(mysql_global_status_commands_total{command=\"update\",uuid=\"10.249.22.179_11086\"}[1m])
```

#### 2. 连接数

```
# 最大连接数
mysql_global_variables_max_connections{uuid=\"10.249.22.179_11086\"}

# 当前连接数
mysql_global_status_threads_connected{uuid=\"10.249.22.179_11086\"}

# 活动连接数
mysql_global_status_threads_running{uuid=\"10.249.22.179_11086\"}

# 空闲连接
abs((mysql_global_status_threads_connected{uuid=\"10.249.22.179_11086\"} - mysql_global_status_threads_running{uuid=\"10.249.22.179_11086\"}))
```

#### 3. 同一时间运行的线程太多

>  [2.1.4. MySQL high threads running](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-4)

#### 4. 慢查询数量

> [2.1.8. MySQL slow queries](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-8)

2.1.8 看公式好像是增长率

瀚海云上监控的是每分钟有多少个慢查询

```
瀚海云公式:
rate(mysql_global_status_slow_queries{uuid=\"10.249.22.179_11086\"}[1m]
```

#### 5. innodb 锁等待

>  [2.1.9. MySQL InnoDB log waits](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mysql-1-9)


#### 6. MySQL 入流量和出流量

```
rate(mysql_global_status_bytes_received{uuid=\"10.249.22.179_11086\"}[1m])
rate(mysql_global_status_bytes_sent{uuid=\"10.249.22.179_11086\"}[1m])
```

## PostgreSQL

### 一. 报警指标以及阈值

#### 1.  Postgresql down

>  [2.2.1. Postgresql down](https://samber.github.io/awesome-prometheus-alerts/rules#rule-postgresql-1-1) 

#### 2. Postgresql exporter error

>  [2.2.3. Postgresql exporter error](https://samber.github.io/awesome-prometheus-alerts/rules#rule-postgresql-1-3) 

之前用的是zabbix， 所以这个 exporter error 没有用过.

#### 3. 自动清理

> [2.2.4. Postgresql table not auto vacuumed](https://samber.github.io/awesome-prometheus-alerts/rules#rule-postgresql-1-4)

#### 4. pgsql 连接太多

> [2.2.6. Postgresql too many connections](https://samber.github.io/awesome-prometheus-alerts/rules#rule-postgresql-1-6)


#### 5. 主从复制状态和复制延迟, 暂时没找到指标项

## MongoDB

### 一. 报警指标以及阈值

#### 1. MongoDB down

> [2.7.1.1. MongoDB Down](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mongodb-1-1)

#### 2. 连接数

>  [2.7.1.7. MongoDB too many connections](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mongodb-1-7)


#### 3. 副本状态

> [2.7.1.2. Mongodb replica member unhealthy](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mongodb-1-2) 

#### 4. 主从延迟

> [2.7.1.3. MongoDB replication lag](https://samber.github.io/awesome-prometheus-alerts/rules#rule-mongodb-1-3)

## Redis

### 一. 报警指标以及阈值

#### 1. Redis Down

>  [2.6.1. Redis down](https://samber.github.io/awesome-prometheus-alerts/rules#rule-redis-1-1) 

#### 2. Redis 连接数

>  [2.6.10. Redis too many connections](https://samber.github.io/awesome-prometheus-alerts/rules#rule-redis-1-10)

#### 3. Redis 内存快满了

> [2.6.9. Redis out of configured maxmemory](https://samber.github.io/awesome-prometheus-alerts/rules#rule-redis-1-9)

#### 4. 应该有个主从状态的。 没找到

> 不过看起来这个有点像:  [2.6.5. Redis replication broken](https://samber.github.io/awesome-prometheus-alerts/rules#rule-redis-1-5) 